import pyttsx3
import speech_recognition as sr
import wikipedia
import pyjokes
import sys
import webbrowser as web
import pywhatkit
from pywhatkit.remotekit import start_server
from flask import Flask, request


engine = pyttsx3.init()
engine.setProperty("volume", 0.7)
engine.setProperty("rate", 150)
voices = engine.getProperty("voices")
engine.setProperty('voice', voices[1].id)
rs = sr.Recognizer()


def machine_talk(text):
    engine.say(text)
    engine.runAndWait()


def run_botfriend():
    with sr.Microphone() as source:
        rs.adjust_for_ambient_noise(source)
        print("\nListening")
        audio_recorded = rs.listen(source)
    try:
        command = rs.recognize_google(audio_recorded, language="en-in")
        command = command.lower()

        if "BotFriend" in command:
            command = command.replace('BotFriend', "")
        else:
            print("You said " +command)

        if "hello" in command:
            print("Hello How can I Help You?")
            machine_talk("Hello How can I Help You?")
        elif "who are you" in command:
            print("I am Bot Friend")
            machine_talk("I am Bot Friend a k a Your personal help assistant")
        elif "can you do" in command:
            print("Everything")
            machine_talk("Everything")
        elif "play" in command:
            song = command.replace('play', '')
            print('Playing'+song)
            machine_talk('Playing'+song)
            pywhatkit.playonyt(song)
        elif "who is" in command:
            name = command.replace('who is', '')
            info = wikipedia.summary(name, 1)
            print(info)
            machine_talk(info)

        elif "search on google about" in command:
            name = command.replace('search on google about', '')
            machine_talk('searching about '+name)
            pywhatkit.search(name)
        elif 'what is' in command:
            search = 'https://www.google.com/search?q=' + command
            print(' Here is what i found on the internet..')
            machine_talk('searching... Here is what i found on the internet..')
            web.open(search)
        elif 'joke' in command:
            _joke = pyjokes.get_joke()
            print(_joke)
            machine_talk(_joke)
        elif 'thank you' in command:
            print("you are welcome")
            machine_talk('you are welcome')
        elif 'open google' in command:
            print('opening google ...')
            machine_talk('opening google..')
            web.open_new('https://www.google.co.in/')
        elif 'gmail' in command:
            print('opening gmail ...')
            machine_talk('opening gmail..')
            web.open_new('https://mail.google.com/')
        elif 'open youtube' in command:
            print('opening you tube ...')
            machine_talk('opening you tube..')
            web.open_new('https://www.youtube.com/')
        elif 'open instagram' in command:
            print('opening instagram ...')
            machine_talk('opening insta gram...')
            web.open_new('https://www.instagram.com/')
        elif 'bye' or 'stop' or 'quit' in command:
            print('good bye, see you soon !!')
            machine_talk("Good bye, see you soon")
            sys.exit()


    except Exception as ex:
        print(ex)


print('Setting up everything...Please wait')
machine_talk('Setting up everything...Please wait')
print('\n')
print("Hello Musharraf I am your Google assistant, how can i help you ??")
machine_talk("hello musharraf, i am your google assistant, how can i help you ")
while True:
    run_botfriend()